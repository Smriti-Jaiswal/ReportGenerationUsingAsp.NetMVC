(function() {var g;window.navigator.userAgent.match(/Macintosh/);window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""));function p(){this.xhr=null}p.prototype.cancel=function(){this.xhr&&(this.xhr.abort(),this.xhr=null)};p.prototype.finish=function(){this.xhr=null};function q(a){this.R=a&&a.analyticsContext||null;this.J=a&&a.authToken||null;this.K=a&&a.authzToken||null;this.V=a&&a.brandRestriction||null;this.W=a&&a.buildName||null;this.X=a&&a.buildSha||null;this.u=a&&a.csrfTokens||{};this.N=a&&a.serverRoot||null;this.ya=!!this.N;this.za=this.N?this.N+"/_ajax":"/_ajax"}
q.prototype.copy=function(a){var b={analyticsContext:this.R,authToken:this.J,authzToken:this.K,brandRestriction:this.V,buildName:this.W,buildSha:this.X,serverRoot:this.N},c;for(c in a)b[c]=a[c];if(null===a.csrfTokens)c=null;else{c={};a=a.csrfTokens||{};for(var e in this.u)c[e]=this.u[e];for(e in a)c[e]=a[e]}b.csrfTokens=c;return new q(b)};function r(a){var b=a.indexOf("/",1);return-1==b?a:a.substring(0,b)}q.prototype.get=function(a,b){var c=new p;this.send("GET",a,null,!0,null,c,null,b);return c};
q.prototype.post=function(a,b,c,e){var d=new p;u(this,"POST",a,b,!0,0,d,c,e);return d};function v(a,b){var c;return(new P(function(e,d){c=a.post("/google/requesttokens",b,null,function(a,b){200<=a&&300>a?e([b,a]):d([b,a])})})).cancellable().catch(P.CancellationError,function(a){c.cancel();throw a;})}
function u(a,b,c,e,d,f,h,l,n){var m=r(c);if(m in a.u){var k=a.u[m];a.send(b,c,e,d,k,h,l,function(t,y){418==t&&1>f?(a.u[m]==k&&delete a.u[m],u(a,b,c,e,d,f+1,h,l,n)):(n&&n(t,y),h.finish())})}else a.send("GET","/csrf"+m,null,d,null,h,null,function(k,y){200==k?(m in a.u||(a.u[m]=String(y)),u(a,b,c,e,d,f,h,l,n)):(n(k,null),h.finish())})}
q.prototype.send=function(a,b,c,e,d,f,h,l){function n(){4==k.readyState&&m()}function m(){var a,b,c;try{a=k.status;var d,e;try{d=k.getResponseHeader("X-Canva-Auth")}catch(h){}try{e=k.getResponseHeader("X-Canva-Authz")}catch(n){}d&&(t.J="!"!=d?d:null);e&&(t.K="!"!=e?e:null);b=k.responseText}catch(m){if(m.message&&m.message.match(/c00c023f/))a=0,b="";else throw f.finish(),m;}b=b&&b.trim?b.trim():"";d=b.substring(0,20);if(0<d.length){if("'\"])}while(1);\x3c/x\x3e//"!=d){l(500,null);f.finish();return}b=
b.substring(20);try{c=JSON.parse(b)}catch(ea){l(500,null);f.finish();return}}else c=null;l(a,c);f.finish()}b=this.za+b;var k=f.xhr=new XMLHttpRequest,t=this;k.open(a,b,e);this.ya&&(k.withCredentials=!0);"GET"!=a&&d&&k.setRequestHeader("X-Csrf-Token",d);this.R&&k.setRequestHeader("X-Canva-Analytics",this.R);this.J&&k.setRequestHeader("X-Canva-Auth",this.J);this.K&&k.setRequestHeader("X-Canva-Authz",this.K);this.V&&k.setRequestHeader("X-Canva-Brand",this.V);this.W&&k.setRequestHeader("X-Canva-Build-Name",
this.W);this.X&&k.setRequestHeader("X-Canva-Build-Sha",this.X);null===c?a=null:"object"==typeof c&&"undefined"!==typeof Blob&&c instanceof Blob?(k.setRequestHeader("Content-Type",c.type),h&&k.upload.addEventListener("progress",h,!1),a=c):(k.setRequestHeader("Content-Type","application/json;charset\x3dUTF-8"),a=JSON.stringify(c));e?(k.onreadystatechange=n,k.send(a)):(k.send(a),m())};"undefined"!=typeof exports&&(exports.Ea=q);function w(a,b,c,e,d,f){this.j=c;this.ca=e;this.da=d;this.oa=f;this.ea=null;this.F=[];this.ready=!1;this.ta=a;this.Y=b}function x(a,b){var c=$.extend({},b);a.ea&&(c.design=a.ea);c.experience=a.ta;for(var e in a.Y)a.Y.hasOwnProperty(e)&&(c["Experiment:"+e]=a.Y[e]);a.ca&&(c.brand=a.ca);a.da&&(c.cohort=a.da);a.oa&&(c.tier=a.oa);return c}g=w.prototype;g.track=function(){};g.identify=function(a){this.j=a};g.alias=function(){};g.Z=function(){};function z(a,b){null==a.F?b.call(a):a.F.push(b.bind(a))}
g.set=function(){};g.increment=function(){};g.union=function(){};function A(a){a.track("homepage_visit");a.fa(6016629843338)}g.fa=function(a){(window._fbq||(window._fbq=[])).push(["track",a.toString()])};function B(a,b,c,e,d,f){w.apply(this,arguments)}_.extend(B.prototype,w.prototype);g=B.prototype;g.track=function(a,b){window.console&&window.console.log("analytics:track",this.j,a,x(this,b))};g.fa=function(a){window.console&&window.console.log("Facebook track pixelId: "+a)};g.identify=function(a){this.j=a;window.console&&window.console.log("analytics:identify",a)};g.alias=function(a){window.console&&window.console.log("analytics:alias",this.j,a);this.j=a};
g.Z=function(){if(!this.ready)throw Error("not ready");return this.j?this.j:"unknown"};g.set=function(a,b){window.console&&window.console.log("analytics:set",this.j,a);b&&window.setTimeout(b,0)};g.increment=function(a,b){window.console&&window.console.log("analytics:increment",this.j,a,b)};g.union=function(a){window.console&&window.console.log("analytics:union",this.j,a)};function C(a,b,c,e,d,f,h){function l(){for(this.ready=!0;this.F&&0<this.F.length;)this.F.shift()();this.F=null;if(!D){if(e){var a=(new UAParser).getResult(),b=a.browser.name,c=a.browser.version,d=a.device.type,a=a.os.name;d||"Android"!=a&&"iOS"!=a||(d="mobile");this.set({"Most recent browser":b+" "+c,timezone:(new Date).getTimezoneOffset()/-60});this.union({"Operating Systems":[a],Browsers:[b],Devices:[d]})}window.analytics&&window.analytics.page();D=!0}}w.apply(this,[b,c,e,d,f,h]);window.analytics&&
window.analytics.load(a);window.analytics&&window.analytics.ready(l.bind(this))}var D=!1;_.extend(C.prototype,w.prototype);g=C.prototype;g.track=function(a,b){window.analytics&&window.analytics.track(a,x(this,b))};g.identify=function(a){window.analytics&&window.analytics.identify(a)};g.alias=function(a){window.analytics&&window.analytics.alias(a)};g.Z=function(){if(!this.ready||!window.mixpanel)throw Error("not ready");return window.mixpanel.get_distinct_id()};
g.set=function(a,b){window.analytics&&window.analytics.identify(a,b)};g.increment=function(a,b){var c={};c[a]=b;window.analytics&&window.analytics.identify(c)};g.union=function(){};function E(a,b){this.qa=b.appId;this.i=null;this.o=a;this.ba=[];this.status=F}
var F="UNINITIALIZED",G={l:function(a,b){var c=[];b.permissions.data.forEach(function(a){"granted"==a.status&&c.push(a.permission)});this.I=c},param:"permissions"},H={Aa:{l:function(a){this.accessToken=a.accessToken}},Ba:{l:function(a,b){this.email=b.email},param:"email"},Da:{l:function(a,b){this.ha=b.first_name},param:"first_name"},Fa:{l:function(a){this.id=a.userID}},Ga:{l:function(a,b){this.ja=b.last_name},param:"last_name"},Ha:{l:function(a,b){this.name=b.name},param:"name"},Ia:G,Ja:{l:function(a,
b){this.ka=b.picture.data.url},param:"picture.type(large)"},Ca:{l:function(a){this.pa=(new Date).getTime()+1E3*a.expiresIn}}};
E.prototype.init=function(a){function b(a){FB.Event.subscribe("auth.authResponseChange",function(b){"connected"==b.status?I(a).then(c).catch(e):a.i=null});FB.init({version:"v2.2",appId:a.qa,channelUrl:"//"+window.location.hostname+"/static/channel.html",status:!0,xfbml:!1});a.status="INITIALIZED";for(var b=a.ba.length,d=0;d<b;d++)a.ba.pop()(a)}function c(a){d.i=a}function e(){d.i=null}var d=this;"INITIALIZED"==this.status?a(d):(this.ba.push(a),"INITIALIZING"!=this.status&&(this.status="INITIALIZING",
window.fbAsyncInit=function(){b(d)},function(a,b,c){var d=a.getElementsByTagName(b)[0];a.getElementById(c)||(a=a.createElement(b),a.id=c,a.src="//connect.facebook.com/en_US/sdk.js",d.parentNode.insertBefore(a,d))}(document,"script","facebook-jssdk")))};
E.prototype.S=function(a){var b=$.Deferred();this.o.post("/login/facebook",{type:"FACEBOOK",token:a.accessToken},null,function(a,e){switch(a){case 200:b.resolve(e.redirect);break;case 404:b.reject("Could not log you in. Why not try signing up instead?");break;default:b.reject("Failed to log you in ("+a+")")}});return b.promise()};function J(a){return new P(function(b,c){a.getAuthResponse().then(function(e){a.S(e).then(b).fail(c)}).fail(c)})}
function K(a,b){return new P(function(c,e){L(a,[G]).then(function(d){d=d.I;var f=_.difference(b,d);a.i&&(a.i.I=d);f.length?e():c()}).fail(e)})}function I(a){return new P(function(b,c){var e;e=Object.keys(H).map(function(a){return H[a]});L(a,e).then(function(d){d.email?(a.i=new M(d.accessToken,d.email,d.ha,d.id,d.ja,d.name,d.I,d.ka,d.pa),b(a.i)):c("EMAIL_NOT_VERIFIED")}).fail(c)})}
function L(a,b){var c=$.Deferred();a.getAuthResponse().then(function(a){for(var d=[],f=0;f<b.length;f++){var h=b[f];h.param&&d.push(h.param)}d=d.join(",");FB.api("/me?return_ssl_resources\x3d1\x26fields\x3d"+encodeURIComponent(d),function(d){if("error"in d)c.reject("FB_API_ERROR");else{for(var f={},h=0;h<b.length;h++)b[h].l.call(f,a,d);c.resolve(f)}})}).fail(function(b){a.i=null;c.reject(b)});return c.promise()}
E.prototype.getAuthResponse=function(){var a=$.Deferred();FB.getAuthResponse()?a.resolve(FB.getAuthResponse()):FB.getLoginStatus(function(b){"connected"==b.status?a.resolve(b.authResponse):a.reject("UNAUTHORIZED")});return a.promise()};
function N(a){var b=["email","public_profile"];return new P(function(c,e){function d(b){a.i=null;e(b)}function f(f){f.authResponse&&f.status?K(a,b).then(c).catch(d):e("FB_API_ERROR")}var h=_.difference(b,a.i?a.i.I:[]);0<h.length?FB.login(f,{scope:h.join(",")}):K(a,b).then(c).catch(d)})};function M(a,b,c,e,d,f,h,l,n){this.accessToken=a;this.email=b;this.ha=c;this.id=e;this.ja=d;this.name=f;this.I=h;this.ka=l;this.pa=n}M.prototype.aa=function(){return this.email};M.prototype.getName=function(){return this.name};function O(a,b,c){this.name=a||null;this.picture=b||null;this.email=c||null}O.prototype.getName=function(){return this.name};O.prototype.aa=function(){return this.email};function Q(a){this.accessToken=a.accessToken||null;this.v=a.v||null;this.G=a.G;this.A=a.A;this.C=a.C;this.O=null;if(this.accessToken){var b=this;this.L().then(function(){gapi.auth.setToken({accessToken:b.accessToken})})}if(this.C&&!a.v)throw Error("Client cannot be configured with offline and not have a redirectUri");this.L().then(this.U.bind(this,!1))}Q.prototype.load=function(){return this.L()};
function R(a){function b(){$.getJSON("https://www.googleapis.com/oauth2/v1/userinfo?alt\x3djson\x26access_token\x3d"+encodeURIComponent(f.accessToken)).done(e).fail(c);return d.promise()}function c(){d.reject()}function e(a){f.O=a?$.extend(new O,{name:a.name,picture:a.picture,email:a.email}):null;d.resolve(f.O)}if(0>a.A.indexOf("profile"))throw Error("API was not configured with USER_PROFILE_READ scope");var d=$.Deferred(),f=a;return a.O?d.resolve(a.O).promise():a.L().then(a.U.bind(a,!0)).then(b)}
Q.prototype.getToken=function(){return this.accessToken};
(function(){function a(a){var b;try{b=JSON.parse(a.data)}catch(c){return}b.f&&null===document.getElementById(b.f)&&a.stopImmediatePropagation()}var b=$.Deferred(),c;Q.prototype.sa=function(){var a;a=$("\x3cscript\x3e");a[0].onerror=b.reject.bind(b);a.attr({src:"https://apis.google.com/js/client.js?onload\x3dGoogleApiOnGapiLoad",type:"text/javascript"});a.appendTo("head");return a};Q.prototype.L=function(){c||(window.addEventListener("message",a),c=this.sa());return b.promise()};window.GoogleApiOnGapiLoad=
function(){b.resolve()}})();Q.prototype.T=function(){return this.U(!0)};
Q.prototype.U=function(a){function b(a){var b=a&&a.access_token;a=a&&a.code;b?(e.accessToken=b,c.resolve(e.accessToken)):a?c.resolve(a):c.reject("No authentication tokens received.")}var c=jQuery.Deferred(),e=this;this.accessToken?c.resolve(this.accessToken):(a={client_id:this.G,immediate:!a,approval_prompt:"auto",access_type:this.C?"offline":"online",response_type:this.C?"code":"token",scope:this.A},this.C&&(a=$.extend({redirect_uri:this.v},a)),gapi.auth.authorize(a,b));return c.promise()};function S(a,b){this.G=a.clientId;this.v=a.redirectUri;this.A=["profile","email"];this.google=T(this);this.o=b;this.B=null;this.va=3;window.addEventListener("message",this.wa.bind(this),!1);window.canvaGoogleAuthReceiveMessage=this.la.bind(this)}function T(a,b){a.google=new Q({G:a.G,v:a.v,A:a.A,C:!0,accessToken:b});return a.google}g=S.prototype;g.load=function(){return this.google.load()};
g.T=function(){this.B=$.Deferred();var a=this;a.google.T().then(function(b){U(a,b)}.bind(this)).fail(function(b){a.B.reject(b)}.bind(this));return this.B.promise()};function V(a,b){a.B.reject(b||"Sign in with Google failed")}g.wa=function(a){a.origin===window.location.origin&&this.la(a.data)};g.la=function(a){var b;try{b=JSON.parse(a)}catch(c){return}a=b.code;(b=b.error)?this.B.reject("Unable to sign into Google ("+b+")"):a&&U(this,a)};
function U(a,b){function c(a){R(T(h,a.accessToken)).then(function(b){var c=a.accessToken;if(!a.refreshToken&&!c)throw Error("Tokens not sent back on successful ");h.B.resolve({email:b.aa(),xa:a.refreshToken,accessToken:a.accessToken})}).fail(f)}function e(a){429==a&&n<h.va?setTimeout(function(){d(l).spread(c,e)},1E3):V(h,"Token request failed")}function d(a){n++;return v(h.o,a)}function f(){V(h,"Failed to fetch user information")}var h=a,l={code:b,grantType:"authorization_code",redirectUri:h.v,scopes:h.A},
n=0;d(l).spread(c,e)}g.S=function(a){var b=$.Deferred();this.o.post("/login/google",{type:"GOOGLE",accessToken:a.accessToken,refreshToken:a.refreshToken},null,function(a,e){switch(a){case 200:b.resolve(e.redirect);break;case 404:b.reject("Could not log you in. Why not try signing up instead?");break;default:b.reject("Failed to log you in ("+a+")")}});return b.promise()};function W(a){this.mode=a.mode;this.o=a.o;this.analytics=a.analytics;this.google=this.H=null;this.ma=0;this.na=a.na||!1}g=W.prototype;
g.start=function(){X(this);var a=Y();$("#intro",a).removeClass("hidden");$(a).css("margin-top",-$(a).outerHeight()/2);$(".buttonFacebook, .buttonGoogle",Y()).on("click",this.ra.bind(this));a.on("submit",this.ua.bind(this));this.google=new S(window.googleConfig,this.o);this.google.load().done(function(){Z("google")});this.H=new E(this.o,window.facebookConfig);this.H.init(function(){Z("facebook")});if(this.na){var b=$("#username",a),c=$("label[for\x3d'password']",a);b.click(function(){c.show(300)});
c.hide()}"LOGIN"===this.mode?($("#signupLinkWrapper").appendTo($("#loginForm")).addClass("ready"),$("#forgot").on("click",function(){$("#loginForm").addClass("fade");setTimeout(function(){$("#loginForm").addClass("off")},300);$("#forgotForm").removeClass("off");setTimeout(function(){$("#forgotForm").removeClass("fade");"createTouch"in document||$("#forgotEmail").focus()},20);$(".error").text("");return!1}),$("#unForgot").on("click",function(){$("#forgotForm").addClass("fade");setTimeout(function(){$("#forgotForm").addClass("off")},
800);$("#loginForm").removeClass("off");setTimeout(function(){$("#loginForm").removeClass("fade");$("#loginUsername").focus()},20);$(".error").text("");return!1})):$("#loginLinkWrapper").appendTo($("#signupForm")).addClass("ready")};
g.ua=function(){var a=Y(),b=aa(this);if(!b)return!1;if("SIGNUP"===this.mode){var c=$("#authMode",Y()).val(),e="google"===c;$("#password",a).prop("disabled","email"!==c);$("#facebookToken",a).prop("disabled","facebook"!==c);$("#googleAccessToken",a).prop("disabled",!e);$("#googleRefreshToken",a).prop("disabled",!e);a=a.data("reservationMode");this.ma++;this.analytics.track("signup_submitted",{by:a.toLowerCase(),method:c,attempts:this.ma,hasErrors:!b})}return b};
function aa(a){var b=$("#authMode").val();if("facebook"==b||"google"==b)return!0;var c=Y();if(1==c.data("auto-submit"))return!0;var b=[],e=$("#email",c),c=$("#password",c);e.val()||b.push("An email address is required");c.val()||b.push("You must specify a password");return 0<b.length?(a.D(b),!1):!0}
g.ra=function(a){var b=$(a.target),c=$(".errors",Y());c.animate({opacity:0},300,"swing",function(){c.empty()});var e=b.hasClass("buttonFacebook"),d=b.hasClass("buttonGoogle");e?(a.preventDefault(),ba(this,b)):d&&(a.preventDefault(),ca(this,b));(d||e)&&da(b)};function da(a){a.hasClass("buttonSpinner")||(a.addClass("buttonSpinner"),a.append('\x3cdiv class\x3d"spinner"/\x3e'))}g.ia=function(a){a.hasClass("buttonSpinner")&&($(".spinner",a).remove(),a.removeClass("buttonSpinner"))};
function ba(a,b){function c(a){J(d.H).then(function(a){var b=(new UAParser).getResult().browser;"Safari"!==b.name||"8"!==b.major||"DESIGN_BUTTON"!==window.analyticsConfig.experience?window.location.href=window._loginRedirect||a:window.location.reload()}).catch(function(b){var c=Y();"SIGNUP"===d.mode?($("#authMode",c).val("facebook"),$("#facebookToken",c).val(a.accessToken),$("#email",c).val(a.aa()),c.submit()):d.D(b)})}function e(a){switch(a){case "EMAIL_NOT_VERIFIED":a="The email address for this Facebook account is unverified.";
break;default:a="Could not sign in using Facebook. "}d.D(a)}var d=a;N(a.H).then(function(){I(d.H).then(c).catch(e)}).catch(function(){d.D("You must authorize Canva to sign in with Facebook.")}).finally(a.ia.bind(a,b))}
function ca(a,b){a.google.T().then(function(a){c.google.S(a).then(function(a){window.location.href=window._loginRedirect||a}).fail(function(b){"SIGNUP"===c.mode?(b=Y(),$("#authMode",b).val("google"),$("#googleRefreshToken",b).val(a.xa),$("#googleAccessToken",b).val(a.accessToken),$("#email",b).val(a.email),b.submit()):c.D(b)})}.bind(a)).fail(a.D.bind(a)).always(a.ia.bind(a,b));var c=a}
g.D=function(a){a=_.isArray(a)?a:[a];if(0!==a.length){var b="";_.each(a,function(a){b+="\x3cdiv\x3e"+a+"\x3c/div\x3e"});a=$(".errors",Y());a.html(b);a.animate({opacity:1},500)}};function X(a){if("SIGNUP"===a.mode){var b=$("#analyticsId").val().toString();b?a.analytics.identify(b):z(a.analytics,function(){$("#analyticsId",Y()).val(a.analytics.Z())});window.location.href.match(/\.com\/?$/)&&A(a.analytics);a.analytics.track("signup_form_loaded")}}
function Z(a){var b=Y();a=".button"+(a.charAt(0).toUpperCase()+a.slice(1));b=$(a,b);b.removeClass("disabled");b.prop("disabled",!1)}function Y(){return $(".signupForm")};$(function(){var a;var b=window.analyticsConfig;if(b){a=b.user;var c=b.brand,e=b.cohort,d=b.tier,f=b.experience,h=b.experiments,l=b.impl;switch(l){case "console":b=new B(f,h,a,c,e,d);break;case "segment":b=new C(b.segmentWriteKey,f,h,a,c,e,d);break;default:throw Error("Cant find analytics implementation "+l);}a&&b.identify(a);a=b}else a=null;(new W({analytics:a,o:new q(window.httpServiceConfig),mode:"SIGNUP"})).start()});})();
